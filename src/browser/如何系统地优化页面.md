通常一个页面有三个阶段: 加载阶段、交互阶段和关闭阶段
- 加载阶段, 是指从发出请求到渲染出完整页面的过程, 影响到这个阶段的主要因素有网络和js脚本
- 交互阶段, 主要是从页面加载完成到用户交互交互的整合过程, 影响到这个阶段的主要因素是js脚本
- 关闭阶段, 主要是用户发出关闭指令后页面所做的一些清理操作. 

并非所有的资源都会阻塞页面的首次绘制, 比如图片、音频、视频等文件就不会阻塞页面的首次渲染; 
而js、首次请求的html资源文件、css文件是会阻塞首次渲染的, 因为在构建DOM的过程中需要HTML和js文件, 在构造渲染树的过程中需要用到css文件.  

把能阻塞网页首次渲染的资源称为关键资源. 基于关键资源, 可以继续细化出三个影响页面首次渲染的核心因素: 
1. 关键资源个数. 关键资源个数越多, 首次页面的加载时间就会越长
2. 关键资源大小. 通常情况下, 所有关键资源的内容越小, 其整个资源的下载时间也就越短, 那么阻塞渲染的时间也就越短.
3. 请求关键资源需要多少个RTT(Round Trip Time). 

RTT是网络中一个重要的性能指标, 表示从发送端发送数据开始, 到发送端接收到来自接收端的确认, 总共经历的时延. 通常
1个HTTP的数据包在14KB左右, 所以1个0.1M的页面就需要拆分成8个包来传输了, 也就是说需要8个RTT. 

**总的优化原则就是减少关键资源个数, 降低关键资源大小, 降低关键资源的RTT次数.**
- 如何减少关键资源个数?一种方式是可以将js和css改成内联的形式; 另一种方式, 如果js代码没有dom或者cssom的操作, 则可以改成async或者defer属性;
- 如何减少关键资源的大小?可以压缩css和js资源, 移除html、css、js文件中的一些注释内容
- 如何减少关键资源RTT的次数?可以通过减少关键资源的个数和减少关键资源的大小搭配来实现. 除此之外, 还可以使用CDN来减少每次RTT时长. 


谈交互阶段的优化, 其实就是在谈渲染进程渲染帧的速度, 因为在交互阶段, 帧的渲染速度决定了交互的流畅度.
因此讨论页面优化实际上就是讨论渲染引擎是如何渲染帧的, 否则就无法优化帧率.  

**一个大的原则就是让单个帧的生成独断变快:**
1. 减少js脚本执行时间: 将一次执行的函数分解为多个任务, 使得每次执行时间不要过久; 采用web workers, 可以把web workders当作主线程之外的一个线程, 在web workers中是可以执行js脚本的, 不过web workders中没有dom、cssom环境, 这意味着web workder是无法通过js来访问dom的, 所以我们可以把一些和dom操作无关且耗时的任务放到web workers中去执行. 
**在交互阶段, 对js脚本总的原则是不要一次霸占主线程太久**

2. 避免强制同步布局: 所谓强制同步布局, 是指js强制将计算样式和布局操作提前到当前的任务中. 为了避免强制同步布局, 我们可以调整策略, 在修改DOM之前查询相关值.  
3. 避免布局抖动: 所谓布局抖动, 是指在一次js执行过程中, 多次执行强制布局和抖动操作. 
4. 合理利用css合成动画: 如果提前知道对某个元素执行动画操作, 最好将其标记为will-change, 这是告诉渲染引擎需要将该元素单独生成一个图层.  
5. 避免频繁的垃圾回收: 尽可能优化存储结构, 尽可能避免小颗粒对象的产生.  




