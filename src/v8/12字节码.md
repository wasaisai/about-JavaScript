### 字节码

所谓字节码, 是指在编译过程中的中间代码, 可以把字节码看成是机器代码的抽象, 在v8中, 字节码有两个作用: 
- 解释器可以直接解释执行字节码;  
- 优化编译器可以将字节码编译为二进制代码, 然后再执行二进制机器代码;  

### 机器代码缓存
v8使用两种代码缓存策略来缓存生成的代码
1. v8第一次执行代码时, 会编译源js代码, 并将编译后的二进制代码缓存在内存中, 我们把这种方式称为**内存缓存(in-memory cache)** 然后通过js源文件的字符串在内存中查找对应的编译后的二进制代码. 这样当再次执行到这段代码时, v8就可以直接去内存中查找是否编译过这段代码. 如果内存缓存中存在这段代码所对应的二进制代码, 那么就直接执行编译好的二进制代码.  
2. v8除了采用将代码缓存在内存中的策略之外, 还会将代码缓存在硬盘上,, 这样即便关闭了浏览器, 下次重新打开浏览器再次执行相同的代码时, 也可以直接重复使用编译好的二进制代码.  


有了字节码, 无论是解释器的解释执行, 还是优化编译器的编译执行, 都可以直接针对字节码来进行操作.由于字节码占用的空间远小于二进制代码, 所以浏览器就可以实现缓存所有的字节码, 而不仅仅是缓存顶层的字节码.  


早期v8为了提升代码的执行速度, 直接将js源代码编译成了没有优化的二进制的机器代码, 如果某一段二进制代码执行频率过高, 那么v8会将其标记为热点代码, 热点代码会被优化编译器优化, 优化后的机器代码执行效率更高. 

随着移动设备的普及, V8团队逐渐发现将js源代码直接编译成二进制代码存在两个致命问题: 
- 时间问题: 编译时间过久, 影响代码启动速度;
- 空间问题: 缓存编译后的二进制代码占用更多的内存;  
 
字节码的优势:   
1. 解决启动问题: 生成字节码的时间很短;
2. 解决空间问题: 字节码占用内存不多, 缓存字节码会大大降低内存的使用;
3. 代码架构清晰: 采用字节码, 可以简化程序的复杂度, 使得V8移植到不同的cpu架构平台更容易.  


