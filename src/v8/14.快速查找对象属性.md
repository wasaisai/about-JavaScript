### 为什么静态语言的效率更高  
js在运行时, 对象属性是可以被修改的, 所以当v8使用了一个对象时, 比如使用了start.x的时候, 它并不知道该对象中是否具有x属性, 也不知道x相对于对象的偏移量是多少, 也可以说v8并不知道该对象的具体形状.  
那么,当在js中要查询对象start中的x属性时, v8会按照具体的规则一步一步来查询, 这个过程非常慢且耗时.  

因为静态语言可以直接通过偏移量来查询对象的属性值, 这也就是静态语言的执行效率高的一个原因.  

### 隐藏类  
目前V8中采用的一个思路是, 将js中的对象静态化, 也就是v8在运行js的过程中, 会假设js中的对象是静态的, 具体地讲, v8对每个对象做如下两点假设: 
- 对象创建好了之后就不会添加新的属性;  
- 对象创建好了之后也不会删除属性;  

符合这两个假设后, v8就可以对js中的对象做深度优化了, 如何优化呢?  
具体的讲, v8会为每个对象创建一个隐藏类, 对象的隐藏类中记录了该对象一些基础的布局信息, 包括以下两点:  
- 对象中所包含的所有属性;  
- 每个属性相对于对象的偏移量;  

有了隐藏类之后, v8访问某个对象中的某个属性时, 会先去隐藏类中查找该属性相对于它的对象的偏移量, 有了偏移量和属性类型, v8就可以直接去内存中取出对应的属性值, 而不需要经历一系列的查找过程, 这大大提升了v8查找对象的效率.  
<br>  
```
let point = {
    x: 100,
    y: 200
}
```

当v8执行到这段代码时, 会先为point对象创建一个隐藏类, 在v8中, 把隐藏类称为**map**, 每个对象都有一个map属性, 其值指向内存中的隐藏类. 

隐藏类描述了对象的属性布局, 它主要包括了属性名称和每个属性所对应的偏移量

有了map之后, 使用point.x访问x属性时, v8会查询point的map中的x属性相对point对象的偏移量, 然后将point对象的起始位置加上偏移量, 就得到了x属性的值在内存中的位置, 有了这个位置也就拿到了x的值, 这样就省去了比较复杂的查找过程. 


### 多个对象共用一个隐藏类  
如果两个对象的形状是相同的, v8就会为其复用同一个隐藏类, 这样有两个好处:  
1. 减少隐藏类的创建次数, 也间接加速了代码的执行速度.  
2. 减少了隐藏类的存储空间.  

什么情况下两个对象的形状是相同的:  
1. 相同的属性名称;  
2. 相等的属性个数;  


### 重新构建隐藏类  
js是动态语言, 在执行过程中, 对象的形状是可以被改变的, 如果某个对象的形状改变了, 隐藏类也会随着改变, 这意味着v8要为新改变的对象重新构建新的隐藏类, 这对于V8的执行效率来说, 是一笔大的开销.  

给一个对象添加新的属性, 删除新的属性, 或者改变某个属性的数据类型都会改变这个对象的形状, V8会为改变形状后的对象重新建新的隐藏类.  


### 最佳实践  
1. 使用字面量初始化对象时, 要保证属性的顺序是一致的; 

``` 
let point = {
    x: 100,
    y:200
};
let point2 = {
    y: 3,
    x: 1
};
```
虽然创建时的对象属性是一样的,但是它们初始化的顺序不一样, 这也会导致形状不同, 所以它们会有不同的隐藏类;  
2. 尽量使用字面量一次性初始化完整对象属性;
3. 尽量避免使用delete方法. delete会破坏对象的形状, 同样会导致v8为该对象重新生成新的隐藏类.  

